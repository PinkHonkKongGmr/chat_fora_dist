(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{11:function(e,t){e.exports={COMMUNIYU_CHAT:"COMMUNIYU_CHAT",USER_CONNECTED:"USER_CONNECTED",MESSAGE_RECIEVED:"MESSAGE_RECIEVED",MESSAGE_SENT:"MESSAGE_SENT",USER_DISCONNECTED:"USER_DISCONNECTED",TYPING:"TYPING",VERIFY_USER:"VERIFY_USER",JOIN_ROOM:"JOIN_ROOM",NEW_ROOM:"NEW_ROOM",LOGOUT:"LOGOUT"}},111:function(e,t){},113:function(e,t){},118:function(e,t,n){},119:function(e,t,n){},128:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),s=n(58),r=n.n(s),c=function(e){var t=e.children;return i.a.createElement(a.Fragment,null,t)},o=n(61),l=n(14),u=n(2),m=n(3),h=n(5),d=n(4),p=n(6),f=n(27),E=n.n(f),v=n(11),O=(n(97),function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).setUser=function(e){var t=e.user,a=e.isUser;if(console.log(a),a)n.setError("\u0442\u0430\u043a\u043e\u0439 \u0432\u043e\u043b\u0447\u043e\u043d\u043e\u043a \u0443\u0436\u0435 \u0435\u0441\u0442\u044c");else{var i=n.props.socket;n.props.setUser(t),n.setState({login:!0}),localStorage.setItem("name",t.name),localStorage.setItem("id",t.id),i.emit(v.NEW_ROOM,n.props.id),setTimeout(function(){window.location.href=n.state.chatLink},0)}},n.handleSubmit=function(e){e.preventDefault();var t=n.props.socket,a=n.state.nickname;t.emit(v.VERIFY_USER,a,localStorage.getItem("id"),n.setUser)},n.handleChange=function(e){n.setState({nickname:e.target.value})},n.setError=function(e){n.setState({error:e}),setTimeout(function(){n.setState({error:""})},1100)},n.state={nickname:"",error:"",login:!1,chatLink:"/chatroom/"+n.props.id},n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this,t=this.state,n=t.nickname,a=t.error;return i.a.createElement("div",{className:"login"},i.a.createElement("form",{onSubmit:this.handleSubmit,className:"login-form"},i.a.createElement("label",{htmlFor:"nickname"},i.a.createElement("h1",null,i.a.createElement("span",{className:"chatV"},"\u0427\u0410\u0422 \u0412\u041e\u041b\u0427\u0410\u0422__"),i.a.createElement("span",{className:"web"},"[web2019]")),i.a.createElement("p",null,"\u0427\u0430\u0442 \u0431\u0435\u0437 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438.\u041f\u0440\u043e\u0441\u0442\u043e \u0432\u0432\u0435\u0434\u0438 \u0438\u043c\u044f \u0438 \u043e\u0431\u0449\u0430\u0439\u0441\u044f!")),i.a.createElement("input",{ref:function(t){e.textInput=t},type:"text",id:"nickname",value:n,onChange:this.handleChange,placeholder:"enter_here_volchonok_name"}),i.a.createElement("div",{className:"error"},a||null)))}}]),t}(a.Component)),b="http://localhost:5000",S=n(98),g=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).initSocket=function(){var e=E()(b);e.on("connect",function(){console.log("connected")}),n.setState({socket:e})},n.setUser=function(e){n.state.socket.emit(v.USER_CONNECTED,e),n.setState({user:e})},n.logout=function(){n.state.socket.emit(v.LOGOUT),n.setState({user:null})},n.state={socket:null,user:null,chatLink:null},n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"componentWillMount",value:function(){this.initSocket(),this.props.id?this.setState({chatLink:this.props.id}):this.setState({chatLink:S()})}},{key:"render",value:function(){var e=this.state.socket;return i.a.createElement("div",{className:"container"},i.a.createElement(O,{socket:e,setUser:this.setUser,id:this.state.chatLink}))}}]),t}(a.Component),k=function(e){function t(){return Object(u.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"App"},i.a.createElement(g,null))}}]),t}(a.Component),j=n(13),y=function(){function e(t){Object(u.a)(this,e),this.soundState=t}return Object(m.a)(e,[{key:"getPermissions",value:function(){return new Promise(function(e){var t=window.confirm("\u0441\u0442\u0440\u0438\u043c \u0441\u043e \u0437\u0432\u0443\u043a\u043e\u043c?");navigator.mediaDevices.getUserMedia({video:!0,audio:t}).then(function(t){console.log(e),e(t)})})}}]),e}(),N=n(59),I=n.n(N),U=n(60),_=n.n(U),C=(n(118),function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).state={hasMedia:!1,otherUserId:null,participants:null},n.user={id:localStorage.getItem("id")},n.user.stream=null,n.peers={},n.mediaHandler=new y,n.setupPusher(),n.callTo=n.callTo.bind(Object(j.a)(Object(j.a)(n))),n.setupPusher=n.setupPusher.bind(Object(j.a)(Object(j.a)(n))),n.startPeer=n.startPeer.bind(Object(j.a)(Object(j.a)(n))),n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"componentWillMount",value:function(){var e=this;console.log(this.user.id);var t=this.props.socket;t.on("connect",function(){t.emit(v.JOIN_ROOM,e.props.id,localStorage.getItem("id"),localStorage.getItem("name"))}),t.on(v.JOIN_ROOM,function(t,n){t===e.props.id&&e.setState({participants:n})}),this.mediaHandler.getPermissions().then(function(t){e.setState({hasMedia:!0}),e.user.stream=t;try{e.myVideo.srcObject=t}catch(n){e.myVideo.src=URL.createObjectURL(t)}e.myVideo.play()})}},{key:"setupPusher",value:function(){var e=this;this.pusher=new I.a("fd3df13aec3b16a9a3af",{cluster:"eu",authEndpoint:"http://localhost:5000/pusher/auth",forceTLS:!0,auth:{params:this.user.id}}),this.channel=this.pusher.subscribe("presence-videocall"),this.channel.bind("client-signal-".concat(this.user.id),function(t){console.log("\u043a\u043b\u0438\u0435\u043d\u0442 \u0441\u0438\u0433\u043d\u0430\u043b");var n=e.peers[t.userId];void 0===n&&(e.setState({otherUserId:t.userId}),n=e.startPeer(t.userId,!1)),n.signal(t.data)})}},{key:"startPeer",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];console.log("\u0441\u0442\u0430\u0440\u0442_\u043f\u0438\u0440");var a=new _.a({initiator:n,stream:this.user.stream,trickle:!1});return a.on("signal",function(n){console.log("\u0441\u0438\u0433\u043d\u0430\u043b"),t.channel.trigger("client-signal-".concat(e),{type:"signal",userId:t.user.id,data:n})}),a.on("stream",function(e){try{if(!window.confirm("\u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0441\u0442\u0440\u0438\u043c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f?"))return;t.userVideo.srcObject=e}catch(n){t.userVideo.srcObject=e}t.userVideo.play()}),a.on("close",function(){var n=t.peers[e];void 0!==n&&n.destroy(),t.peers[e]=void 0}),a}},{key:"callTo",value:function(e){this.peers[e]=this.startPeer(e)}},{key:"render",value:function(){var e,t,n=this;return t=null==this.state.participants?0:this.state.participants.length,null!==this.state.participants&&(e=this.state.participants.map(function(e,t){return i.a.createElement("span",{key:t},i.a.createElement("span",{className:"participants"},e.name),n.user.id!==e.id?i.a.createElement("button",{className:"btn btn-outline-warning",key:e.id,onClick:function(){return n.callTo(e.id)}},"Call ",e.name):null)})),null==this.state.participants&&(e=i.a.createElement("b",null)),i.a.createElement("div",{className:"streamWindow"},i.a.createElement("div",{className:"participants"},"\u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0443\u0447\u0430\u0441\u0442\u043d\u0438\u043a\u043e\u0432:",t),e,i.a.createElement("div",{className:"video-container"}),i.a.createElement("div",{className:"video-container"},i.a.createElement("video",{autoPlay:!0,playsInline:!0,className:"my-video",ref:function(e){n.myVideo=e}}),i.a.createElement("video",{autoPlay:!0,playsInline:!0,className:"user-video",ref:function(e){n.userVideo=e}})))}}]),t}(a.Component)),R=(n(119),"http://localhost:5000"),w=n(11).MESSAGE_SENT,M=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).initSocket=function(){var e=E()(R);e.on(w,function(e){e.chat===n.props.id&&n.setState({messages:e.messageArray})}),n.setState({socket:e})},n.handleSubmit=function(e){e.preventDefault();var t=e.target.elements.input.value;if(t){var a={body:t,from:n.props.name,chat:n.props.id};n.state.socket.emit(w,a),e.target.elements.input.value=""}},n.state={messages:[],socket:null},n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"componentWillMount",value:function(){this.initSocket()}},{key:"componentDidUpdate",value:function(){this.chatWindowRef.scrollTop=this.chatWindowRef.scrollHeight}},{key:"render",value:function(){var e=this,t=this.state.socket,n=this.props.id,a=this.state.messages.map(function(e,t){return i.a.createElement("li",{key:t},i.a.createElement("b",null,e))});return i.a.createElement("div",null,i.a.createElement("h1",null,"\u0427\u0410\u0442 \u0432\u043e\u043b\u0447\u0430\u0442"),i.a.createElement("div",{className:"chatRoom"},i.a.createElement(C,{socket:t,id:n}),i.a.createElement("div",null,i.a.createElement("form",{onSubmit:this.handleSubmit},i.a.createElement("input",{id:"input",type:"text",placeholder:"Enter a message"})),i.a.createElement("div",{ref:function(t){return e.chatWindowRef=t},className:"chatWindow"},a))))}}]),t}(i.a.Component),T=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(h.a)(this,Object(d.a)(t).call(this,e))).state={id:n.props.match.params.id,name:localStorage.getItem("name"),verify:!1},n}return Object(p.a)(t,e),Object(m.a)(t,[{key:"componentWillMount",value:function(){localStorage.getItem("name")&&this.setState({verify:!0})}},{key:"render",value:function(){var e=this.state.verify;return console.log(e),i.a.createElement("div",{className:"App"},e?i.a.createElement(M,{name:this.state.name,id:this.state.id}):i.a.createElement(g,{id:this.state.id}))}}]),t}(a.Component);r.a.render(i.a.createElement(o.a,null,i.a.createElement(c,null,i.a.createElement(l.c,null,i.a.createElement(l.a,{exact:!0,path:"/",component:k}),i.a.createElement(l.a,{exact:!0,path:"/chatroom/:id",component:T})))),document.getElementById("root"))},64:function(e,t,n){e.exports=n(128)},94:function(e,t){},97:function(e,t,n){}},[[64,1,2]]]);
//# sourceMappingURL=main.fbebfa33.chunk.js.map